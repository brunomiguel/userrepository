{
  "manifest": {
    "author": {
      "name": "Patrik Simek",
      "url": "https://patriksimek.cz"
    },
    "name": "vm2",
    "description": "vm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!",
    "keywords": [
      "sandbox",
      "prison",
      "jail",
      "vm",
      "alcatraz",
      "contextify"
    ],
    "version": "3.9.13",
    "main": "index.js",
    "sideEffects": false,
    "repository": {
      "type": "git",
      "url": "https://github.com/patriksimek/vm2.git"
    },
    "license": "MIT",
    "dependencies": {
      "acorn": "^8.7.0",
      "acorn-walk": "^8.2.0"
    },
    "devDependencies": {
      "eslint": "^5.16.0",
      "eslint-config-integromat": "^1.5.0",
      "mocha": "^6.2.2"
    },
    "engines": {
      "node": ">=6.0"
    },
    "scripts": {
      "test": "mocha test",
      "pretest": "eslint ."
    },
    "bin": {
      "vm2": "bin/vm2"
    },
    "types": "index.d.ts",
    "_registry": "npm",
    "_loc": "/home/brunomiguel/userrepository/pkgbuild/cerebro/src/yarn-cache/v6/npm-vm2-3.9.13-d4bcc2189e2e05efcd82e09172ba41c708950012/node_modules/vm2/package.json",
    "readmeFilename": "README.md",
    "readme": "# vm2 [![NPM Version][npm-image]][npm-url] [![NPM Downloads][downloads-image]][downloads-url] [![Package Quality][quality-image]][quality-url] [![Node.js CI](https://github.com/patriksimek/vm2/actions/workflows/node-test.yml/badge.svg)](https://github.com/patriksimek/vm2/actions/workflows/node-test.yml) [![Known Vulnerabilities][snyk-image]][snyk-url]\n\nvm2 is a sandbox that can run untrusted code with whitelisted Node's built-in modules. Securely!\n\n## Features\n\n* Runs untrusted code securely in a single process with your code side by side\n* Full control over the sandbox's console output\n* The sandbox has limited access to the process's methods\n* It is possible to require modules (built-in and external) from the sandbox\n* You can limit access to certain (or all) built-in modules\n* You can securely call methods and exchange data and callbacks between sandboxes\n* Is immune to all known methods of attacks\n* Transpiler support\n\n## How does it work\n\n* It uses the internal VM module to create a secure context.\n* It uses [Proxies](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Proxy) to prevent escaping from the sandbox.\n* It overrides the built-in require to control access to modules.\n\n## What is the difference between Node's vm and vm2?\n\nTry it yourself:\n\n```js\nconst vm = require('vm');\nvm.runInNewContext('this.constructor.constructor(\"return process\")().exit()');\nconsole.log('Never gets executed.');\n```\n\n```js\nconst {VM} = require('vm2');\nnew VM().run('this.constructor.constructor(\"return process\")().exit()');\n// Throws ReferenceError: process is not defined\n```\n\n## Installation\n\n**IMPORTANT**: VM2 requires Node.js 6 or newer.\n\n```sh\nnpm install vm2\n```\n\n## Quick Example\n\n```js\nconst {VM} = require('vm2');\nconst vm = new VM();\n\nvm.run(`process.exit()`); // TypeError: process.exit is not a function\n```\n\n```js\nconst {NodeVM} = require('vm2');\nconst vm = new NodeVM({\n    require: {\n        external: true,\n        root: './'\n    }\n});\n\nvm.run(`\n    var request = require('request');\n    request('http://www.google.com', function (error, response, body) {\n        console.error(error);\n        if (!error && response.statusCode == 200) {\n            console.log(body); // Show the HTML for the Google homepage.\n        }\n    });\n`, 'vm.js');\n```\n\n## Documentation\n\n* [VM](#vm)\n* [NodeVM](#nodevm)\n* [VMScript](#vmscript)\n* [Error handling](#error-handling)\n* [Debugging a sandboxed code](#debugging-a-sandboxed-code)\n* [Read-only objects](#read-only-objects-experimental)\n* [Protected objects](#protected-objects-experimental)\n* [Cross-sandbox relationships](#cross-sandbox-relationships)\n* [CLI](#cli)\n* [2.x to 3.x changes](https://github.com/patriksimek/vm2/wiki/2.x-to-3.x-changes)\n* [1.x and 2.x docs](https://github.com/patriksimek/vm2/wiki/1.x-and-2.x-docs)\n* [Contributing](https://github.com/patriksimek/vm2/wiki/Contributing)\n\n## VM\n\nVM is a simple sandbox to synchronously run untrusted code without the `require` feature. Only JavaScript built-in objects and Node's `Buffer` are available. Scheduling functions (`setInterval`, `setTimeout` and `setImmediate`) are not available by default.\n\n**Options:**\n\n* `timeout` - Script timeout in milliseconds. **WARNING**: You might want to use this option together with `allowAsync=false`. Further, operating on returned objects from the sandbox can run arbitrary code and circumvent the timeout. One should test if the returned object is a primitive with `typeof` and fully discard it (doing logging or creating error messages with such an object might also run arbitrary code again) in the other case.\n* `sandbox` - VM's global object.\n* `compiler` - `javascript` (default) or `coffeescript` or custom compiler function. The library expects you to have coffee-script pre-installed if the compiler is set to `coffeescript`.\n* `eval` - If set to `false` any calls to `eval` or function constructors (`Function`, `GeneratorFunction`, etc.) will throw an `EvalError` (default: `true`).\n* `wasm` -  If set to `false` any attempt to compile a WebAssembly module will throw a `WebAssembly.CompileError` (default: `true`).\n* `allowAsync` - If set to `false` any attempt to run code using `async` will throw a `VMError` (default: `true`).\n\n**IMPORTANT**: Timeout is only effective on synchronous code that you run through `run`. Timeout does **NOT** work on any method returned by VM. There are some situations when timeout doesn't work - see [#244](https://github.com/patriksimek/vm2/pull/244).\n\n```js\nconst {VM} = require('vm2');\n\nconst vm = new VM({\n    timeout: 1000,\n    allowAsync: false,\n    sandbox: {}\n});\n\nvm.run('process.exit()'); // throws ReferenceError: process is not defined\n```\n\nYou can also retrieve values from VM.\n\n```js\nlet number = vm.run('1337'); // returns 1337\n```\n\n**TIP**: See tests for more usage examples.\n\n## NodeVM\n\nUnlike `VM`, `NodeVM` allows you to require modules in the same way that you would in the regular Node's context.\n\n**Options:**\n\n* `console` - `inherit` to enable console, `redirect` to redirect to events, `off` to disable console (default: `inherit`).\n* `sandbox` - VM's global object.\n* `compiler` - `javascript` (default) or `coffeescript` or custom compiler function (which receives the code, and it's file path). The library expects you to have coffee-script pre-installed if the compiler is set to `coffeescript`.\n* `eval` - If set to `false` any calls to `eval` or function constructors (`Function`, `GeneratorFunction`, etc.) will throw an `EvalError` (default: `true`).\n* `wasm` -  If set to `false` any attempt to compile a WebAssembly module will throw a `WebAssembly.CompileError` (default: `true`).\n* `sourceExtensions` - Array of file extensions to treat as source code (default: `['js']`).\n* `require` - `true` or object to enable `require` method (default: `false`).\n* `require.external` - Values can be `true`, an array of allowed external modules, or an object (default: `false`). All paths matching `/node_modules/${any_allowed_external_module}/(?!/node_modules/)` are allowed to be required.\n* `require.external.modules` - Array of allowed external modules. Also supports wildcards, so specifying `['@scope/*-ver-??]`, for instance, will allow using all modules having a name of the form `@scope/something-ver-aa`, `@scope/other-ver-11`, etc. The `*` wildcard does not match path separators.\n* `require.external.transitive` - Boolean which indicates if transitive dependencies of external modules are allowed (default: `false`). **WARNING**: When a module is required transitively, any module is then able to require it normally, even if this was not possible before it was loaded.\n* `require.builtin` - Array of allowed built-in modules, accepts [\"\\*\"] for all (default: none). **WARNING**: \"\\*\" can be dangerous as new built-ins can be added.\n* `require.root` - Restricted path(s) where local modules can be required (default: every path).\n* `require.mock` - Collection of mock modules (both external or built-in).\n* `require.context` - `host` (default) to require modules in the host and proxy them into the sandbox. `sandbox` to load, compile, and require modules in the sandbox. Except for `events`, built-in modules are always required in the host and proxied into the sandbox.\n* `require.import` - An array of modules to be loaded into NodeVM on start.\n* `require.resolve` - An additional lookup function in case a module wasn't found in one of the traditional node lookup paths.\n* `require.customRequire` - Use instead of the `require` function to load modules from the host.\n* `require.strict` - `false` to not force strict mode on modules loaded by require (default: `true`).\n* `require.fs` - Custom file system implementation.\n* `nesting` - **WARNING**: Allowing this is a security risk as scripts can create a NodeVM which can require any host module. `true` to enable VMs nesting (default: `false`).\n* `wrapper` - `commonjs` (default) to wrap script into CommonJS wrapper, `none` to retrieve value returned by the script.\n* `argv` - Array to be passed to `process.argv`.\n* `env` - Object to be passed to `process.env`.\n* `strict` - `true` to loaded modules in strict mode (default: `false`).\n\n**IMPORTANT**: Timeout is not effective for NodeVM so it is not immune to `while (true) {}` or similar evil.\n\n**REMEMBER**: The more modules you allow, the more fragile your sandbox becomes.\n\n```js\nconst {NodeVM} = require('vm2');\n\nconst vm = new NodeVM({\n    console: 'inherit',\n    sandbox: {},\n    require: {\n        external: true,\n        builtin: ['fs', 'path'],\n        root: './',\n        mock: {\n            fs: {\n                readFileSync: () => 'Nice try!'\n            }\n        }\n    }\n});\n\n// Sync\n\nlet functionInSandbox = vm.run('module.exports = function(who) { console.log(\"hello \"+ who); }');\nfunctionInSandbox('world');\n\n// Async\n\nlet functionWithCallbackInSandbox = vm.run('module.exports = function(who, callback) { callback(\"hello \"+ who); }');\nfunctionWithCallbackInSandbox('world', (greeting) => {\n    console.log(greeting);\n});\n```\n\nWhen `wrapper` is set to `none`, `NodeVM` behaves more like `VM` for synchronous code.\n\n```js\nassert.ok(vm.run('return true') === true);\n```\n\n**TIP**: See tests for more usage examples.\n\n### Loading modules by relative path\n\nTo load modules by relative path, you must pass the full path of the script you're running as a second argument to vm's `run` method if the script is a string. The filename is then displayed in any stack traces generated by the script.\n\n```js\nvm.run('require(\"foobar\")', '/data/myvmscript.js');\n```\n\nIf the script you are running is a VMScript, the path is given in the VMScript constructor.\n\n```js\nconst script = new VMScript('require(\"foobar\")', {filename: '/data/myvmscript.js'});\nvm.run(script);\n```\n\n## VMScript\n\nYou can increase performance by using precompiled scripts. The precompiled VMScript can be run multiple times. It is important to note that the code is not bound to any VM (context); rather, it is bound before each run, just for that run.\n\n```js\nconst {VM, VMScript} = require('vm2');\n\nconst vm = new VM();\nconst script = new VMScript('Math.random()');\nconsole.log(vm.run(script));\nconsole.log(vm.run(script));\n```\n\nIt works for both `VM` and `NodeVM`.\n\n```js\nconst {NodeVM, VMScript} = require('vm2');\n\nconst vm = new NodeVM();\nconst script = new VMScript('module.exports = Math.random()');\nconsole.log(vm.run(script));\nconsole.log(vm.run(script));\n```\n\nCode is compiled automatically the first time it runs. One can compile the code anytime with `script.compile()`. Once the code is compiled, the method has no effect.\n\n## Error handling\n\nErrors in code compilation and synchronous code execution can be handled by `try-catch`. Errors in asynchronous code execution can be handled by attaching `uncaughtException` event handler to Node's `process`.\n\n```js\ntry {\n    var script = new VMScript('Math.random()').compile();\n} catch (err) {\n    console.error('Failed to compile script.', err);\n}\n\ntry {\n    vm.run(script);\n} catch (err) {\n    console.error('Failed to execute script.', err);\n}\n\nprocess.on('uncaughtException', (err) => {\n    console.error('Asynchronous error caught.', err);\n});\n```\n\n## Debugging a sandboxed code\n\nYou can debug or inspect code running in the sandbox as if it was running in a normal process.\n\n* You can use breakpoints (which requires you to specify a script file name)\n* You can use `debugger` keyword.\n* You can use step-in to step inside the code running in the sandbox.\n\n### Example\n\n/tmp/main.js:\n\n```js\nconst {VM, VMScript} = require('.');\nconst fs = require('fs');\nconst file = `${__dirname}/sandbox.js`;\n\n// By providing a file name as second argument you enable breakpoints\nconst script = new VMScript(fs.readFileSync(file), file);\n\nnew VM().run(script);\n```\n\n/tmp/sandbox.js\n\n```js\nconst foo = 'ahoj';\n\n// The debugger keyword works just fine everywhere.\n// Even without specifying a file name to the VMScript object.\ndebugger;\n```\n\n## Read-only objects (experimental)\n\nTo prevent sandboxed scripts from adding, changing, or deleting properties from the proxied objects, you can use `freeze` methods to make the object read-only. This is only effective inside VM. Frozen objects are affected deeply. Primitive types cannot be frozen.\n\n**Example without using `freeze`:**\n\n```js\nconst util = {\n    add: (a, b) => a + b\n}\n\nconst vm = new VM({\n    sandbox: {util}\n});\n\nvm.run('util.add = (a, b) => a - b');\nconsole.log(util.add(1, 1)); // returns 0\n```\n\n**Example with using `freeze`:**\n\n```js\nconst vm = new VM(); // Objects specified in the sandbox cannot be frozen.\nvm.freeze(util, 'util'); // Second argument adds object to global.\n\nvm.run('util.add = (a, b) => a - b'); // Fails silently when not in strict mode.\nconsole.log(util.add(1, 1)); // returns 2\n```\n\n**IMPORTANT:** It is not possible to freeze objects that have already been proxied to the VM.\n\n## Protected objects (experimental)\n\nUnlike `freeze`, this method allows sandboxed scripts to add, change, or delete properties on objects, with one exception - it is not possible to attach functions. Sandboxed scripts are therefore not able to modify methods like `toJSON`, `toString` or `inspect`.\n\n**IMPORTANT:** It is not possible to protect objects that have already been proxied to the VM.\n\n## Cross-sandbox relationships\n\n```js\nconst assert = require('assert');\nconst {VM} = require('vm2');\n\nconst sandbox = {\n    object: new Object(),\n    func: new Function(),\n    buffer: new Buffer([0x01, 0x05])\n}\n\nconst vm = new VM({sandbox});\n\nassert.ok(vm.run(`object`) === sandbox.object);\nassert.ok(vm.run(`object instanceof Object`));\nassert.ok(vm.run(`object`) instanceof Object);\nassert.ok(vm.run(`object.__proto__ === Object.prototype`));\nassert.ok(vm.run(`object`).__proto__ === Object.prototype);\n\nassert.ok(vm.run(`func`) === sandbox.func);\nassert.ok(vm.run(`func instanceof Function`));\nassert.ok(vm.run(`func`) instanceof Function);\nassert.ok(vm.run(`func.__proto__ === Function.prototype`));\nassert.ok(vm.run(`func`).__proto__ === Function.prototype);\n\nassert.ok(vm.run(`new func() instanceof func`));\nassert.ok(vm.run(`new func()`) instanceof sandbox.func);\nassert.ok(vm.run(`new func().__proto__ === func.prototype`));\nassert.ok(vm.run(`new func()`).__proto__ === sandbox.func.prototype);\n\nassert.ok(vm.run(`buffer`) === sandbox.buffer);\nassert.ok(vm.run(`buffer instanceof Buffer`));\nassert.ok(vm.run(`buffer`) instanceof Buffer);\nassert.ok(vm.run(`buffer.__proto__ === Buffer.prototype`));\nassert.ok(vm.run(`buffer`).__proto__ === Buffer.prototype);\nassert.ok(vm.run(`buffer.slice(0, 1) instanceof Buffer`));\nassert.ok(vm.run(`buffer.slice(0, 1)`) instanceof Buffer);\n```\n\n## CLI\n\nBefore you can use vm2 in the command line, install it globally with `npm install vm2 -g`.\n\n```sh\nvm2 ./script.js\n```\n\n## Known Issues\n\n* It is not possible to define a class that extends a proxied class. This includes using a proxied class in `Object.create`.\n* Direct eval does not work.\n* Logging sandbox arrays will repeat the array part in the properties.\n* Source code transformations can result a different source string for a function.\n* There are ways to crash the node process from inside the sandbox.\n\n## Deployment\n\n1. Update the `CHANGELOG.md`\n2. Update the `package.json` version number\n3. Commit the changes\n4. Run `npm publish`\n\n## Sponsors\n\n[![Integromat][integromat-image]][integromat-url]\n\n[npm-image]: https://img.shields.io/npm/v/vm2.svg?style=flat-square\n[npm-url]: https://www.npmjs.com/package/vm2\n[downloads-image]: https://img.shields.io/npm/dm/vm2.svg?style=flat-square\n[downloads-url]: https://www.npmjs.com/package/vm2\n[quality-image]: http://npm.packagequality.com/shield/vm2.svg?style=flat-square\n[quality-url]: http://packagequality.com/#?package=vm2\n[travis-image]: https://img.shields.io/travis/patriksimek/vm2/master.svg?style=flat-square&label=unit\n[travis-url]: https://travis-ci.org/patriksimek/vm2\n[snyk-image]: https://snyk.io/test/github/patriksimek/vm2/badge.svg\n[snyk-url]: https://snyk.io/test/github/patriksimek/vm2\n[integromat-image]: https://static.integromat.com/logo/45_text.png\n[integromat-url]: https://www.integromat.com\n",
    "licenseText": "MIT License\n\nCopyright (c) 2014-2022 Patrik Simek and contributors\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE."
  },
  "artifacts": [],
  "remote": {
    "resolved": "git+https://github.com/patriksimek/vm2.git#d4bcc2189e2e05efcd82e09172ba41c708950012",
    "type": "git",
    "reference": "git+https://github.com/patriksimek/vm2.git",
    "hash": "d4bcc2189e2e05efcd82e09172ba41c708950012",
    "registry": "npm",
    "packageName": "vm2"
  },
  "registry": "npm",
  "hash": "d4bcc2189e2e05efcd82e09172ba41c708950012"
}