"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = void 0;
var _chalk = _interopRequireDefault(require("chalk"));
var _ora = _interopRequireDefault(require("./ora"));
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
class OraImpl {
    // eslint-disable-next-line no-empty-function, no-useless-constructor
    constructor(text = ''){
        this.text = text;
    }
    succeed(_symbol) {
        return this;
    }
    fail(_symbol) {
        return this;
    }
    start() {
        return this;
    }
    stop(_symbol) {
        return this;
    }
    warn(_message) {
        return this;
    }
}
exports.OraImpl = OraImpl;
const asyncOra = (initialOraValue, asyncFn, processExitFn = process.exit)=>{
    let fnOra = new OraImpl(initialOraValue);
    if (asyncOra.interactive) {
        fnOra = (0, _ora).default(initialOraValue).start();
    }
    return new Promise((resolve, reject)=>{
        asyncFn(fnOra).then(()=>{
            const wasPaused = process.stdin.isPaused();
            // Note: this may pause stdin as a side-effect in certain cases
            fnOra.succeed();
            if (asyncOra.keepStdinFlowing && !wasPaused && process.stdin.isPaused()) {
                process.stdin.resume();
            }
            return resolve();
        }).catch((err)=>{
            fnOra.fail();
            if (asyncOra.interactive) {
                if (err && err.message && err.stack) {
                    console.error(_chalk.default.red('\nAn unhandled error has occurred inside Forge:'));
                    console.error(_chalk.default.red(err.message));
                    console.error(_chalk.default.red(err.stack));
                } else {
                    console.error(_chalk.default.red('\nElectron Forge was terminated:'));
                    console.error(_chalk.default.red(typeof err === 'string' ? err : JSON.stringify(err)));
                }
                processExitFn(1);
                // If the process is still alive we should continue because either
                // something went really wrong or we are testing this function
                setTimeout(()=>resolve()
                , 500);
            } else {
                reject(err);
            }
        });
    });
};
asyncOra.interactive = true;
var _default = asyncOra;
exports.default = _default;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vcmEtaGFuZGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgXCJuby1jb25zb2xlXCI6IFwib2ZmXCIgKi9cbmltcG9ydCBjaGFsayBmcm9tICdjaGFsayc7XG5pbXBvcnQgb3JhIGZyb20gJy4vb3JhJztcblxuZXhwb3J0IGNsYXNzIE9yYUltcGwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHktZnVuY3Rpb24sIG5vLXVzZWxlc3MtY29uc3RydWN0b3JcbiAgY29uc3RydWN0b3IocHVibGljIHRleHQ6IHN0cmluZyA9ICcnKSB7fVxuXG4gIHN1Y2NlZWQoX3N5bWJvbD86IHN0cmluZyk6IE9yYUltcGwge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZmFpbChfc3ltYm9sPzogc3RyaW5nKTogT3JhSW1wbCB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzdGFydCgpOiBPcmFJbXBsIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHN0b3AoX3N5bWJvbD86IHN0cmluZyk6IE9yYUltcGwge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgd2FybihfbWVzc2FnZTogc3RyaW5nKTogT3JhSW1wbCB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBc3luY09yYU1ldGhvZCB7XG4gIChpbml0aWFsT3JhVmFsdWU6IHN0cmluZywgYXN5bmNGbjogKG9yYUltcGw6IE9yYUltcGwpID0+IFByb21pc2U8dm9pZD4sIHByb2Nlc3NFeGl0Rm4/OiAoY29kZTogbnVtYmVyKSA9PiB2b2lkKTogUHJvbWlzZTx2b2lkPjtcbiAgaW50ZXJhY3RpdmU/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBUaGlzIHdpbGwga2VlcCBzdGRpbiB1bnBhdXNlZCBpZiBvcmEgaW5hZHZlcnRlbnRseSBwYXVzZXMgaXQuIEJld2FyZSB0aGF0XG4gICAqIGVuYWJsaW5nIHRoaXMgbWF5IGtlZXAgdGhlIG5vZGUgcHJvY2VzcyBhbGl2ZSBldmVuIHdoZW4gdGhlcmUgaXMgbm8gbW9yZVxuICAgKiB3b3JrIHRvIGJlIGRvbmUsIGFzIGl0IHdpbGwgZm9yZXZlciBiZSB3YWl0aW5nIGZvciBpbnB1dCBvbiBzdGRpbi5cbiAgICpcbiAgICogTW9yZSBjb250ZXh0OlxuICAgKiAgIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGVjdHJvbi11c2VybGFuZC9lbGVjdHJvbi1mb3JnZS9pc3N1ZXMvMjMxOVxuICAgKi9cbiAga2VlcFN0ZGluRmxvd2luZz86IGJvb2xlYW47XG59XG5cbmNvbnN0IGFzeW5jT3JhOiBBc3luY09yYU1ldGhvZCA9IChpbml0aWFsT3JhVmFsdWUsIGFzeW5jRm4sIHByb2Nlc3NFeGl0Rm4gPSBwcm9jZXNzLmV4aXQpID0+IHtcbiAgbGV0IGZuT3JhID0gbmV3IE9yYUltcGwoaW5pdGlhbE9yYVZhbHVlKTtcbiAgaWYgKGFzeW5jT3JhLmludGVyYWN0aXZlKSB7XG4gICAgZm5PcmEgPSBvcmEoaW5pdGlhbE9yYVZhbHVlKS5zdGFydCgpO1xuICB9XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgYXN5bmNGbihmbk9yYSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY29uc3Qgd2FzUGF1c2VkID0gcHJvY2Vzcy5zdGRpbi5pc1BhdXNlZCgpO1xuXG4gICAgICAgIC8vIE5vdGU6IHRoaXMgbWF5IHBhdXNlIHN0ZGluIGFzIGEgc2lkZS1lZmZlY3QgaW4gY2VydGFpbiBjYXNlc1xuICAgICAgICBmbk9yYS5zdWNjZWVkKCk7XG5cbiAgICAgICAgaWYgKGFzeW5jT3JhLmtlZXBTdGRpbkZsb3dpbmcgJiYgIXdhc1BhdXNlZCAmJiBwcm9jZXNzLnN0ZGluLmlzUGF1c2VkKCkpIHtcbiAgICAgICAgICBwcm9jZXNzLnN0ZGluLnJlc3VtZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBmbk9yYS5mYWlsKCk7XG4gICAgICAgIGlmIChhc3luY09yYS5pbnRlcmFjdGl2ZSkge1xuICAgICAgICAgIGlmIChlcnIgJiYgZXJyLm1lc3NhZ2UgJiYgZXJyLnN0YWNrKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZCgnXFxuQW4gdW5oYW5kbGVkIGVycm9yIGhhcyBvY2N1cnJlZCBpbnNpZGUgRm9yZ2U6JykpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihjaGFsay5yZWQoZXJyLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoY2hhbGsucmVkKGVyci5zdGFjaykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZCgnXFxuRWxlY3Ryb24gRm9yZ2Ugd2FzIHRlcm1pbmF0ZWQ6JykpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihjaGFsay5yZWQodHlwZW9mIGVyciA9PT0gJ3N0cmluZycgPyBlcnIgOiBKU09OLnN0cmluZ2lmeShlcnIpKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByb2Nlc3NFeGl0Rm4oMSk7XG4gICAgICAgICAgLy8gSWYgdGhlIHByb2Nlc3MgaXMgc3RpbGwgYWxpdmUgd2Ugc2hvdWxkIGNvbnRpbnVlIGJlY2F1c2UgZWl0aGVyXG4gICAgICAgICAgLy8gc29tZXRoaW5nIHdlbnQgcmVhbGx5IHdyb25nIG9yIHdlIGFyZSB0ZXN0aW5nIHRoaXMgZnVuY3Rpb25cbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUoKSwgNTAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH0pO1xufTtcblxuYXN5bmNPcmEuaW50ZXJhY3RpdmUgPSB0cnVlO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luY09yYTtcbiJdLCJuYW1lcyI6WyJPcmFJbXBsIiwidGV4dCIsInN1Y2NlZWQiLCJfc3ltYm9sIiwiZmFpbCIsInN0YXJ0Iiwic3RvcCIsIndhcm4iLCJfbWVzc2FnZSIsImFzeW5jT3JhIiwiaW5pdGlhbE9yYVZhbHVlIiwiYXN5bmNGbiIsInByb2Nlc3NFeGl0Rm4iLCJwcm9jZXNzIiwiZXhpdCIsImZuT3JhIiwiaW50ZXJhY3RpdmUiLCJvcmEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInRoZW4iLCJ3YXNQYXVzZWQiLCJzdGRpbiIsImlzUGF1c2VkIiwia2VlcFN0ZGluRmxvd2luZyIsInJlc3VtZSIsImNhdGNoIiwiZXJyIiwibWVzc2FnZSIsInN0YWNrIiwiY29uc29sZSIsImVycm9yIiwiY2hhbGsiLCJyZWQiLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDa0IsR0FBTyxDQUFQLE1BQU87QUFDVCxHQUFPLENBQVAsSUFBTzs7Ozs7O01BRVZBLE9BQU87SUFDbEIsRUFBcUUsQUFBckUsbUVBQXFFO2dCQUNsREMsSUFBWSxHQUFHLENBQUUsRUFBRSxDQUFDO2FBQXBCQSxJQUFZLEdBQVpBLElBQVk7SUFBUSxDQUFDO0lBRXhDQyxPQUFPLENBQUNDLE9BQWdCLEVBQVcsQ0FBQztRQUNsQyxNQUFNLENBQUMsSUFBSTtJQUNiLENBQUM7SUFFREMsSUFBSSxDQUFDRCxPQUFnQixFQUFXLENBQUM7UUFDL0IsTUFBTSxDQUFDLElBQUk7SUFDYixDQUFDO0lBRURFLEtBQUssR0FBWSxDQUFDO1FBQ2hCLE1BQU0sQ0FBQyxJQUFJO0lBQ2IsQ0FBQztJQUVEQyxJQUFJLENBQUNILE9BQWdCLEVBQVcsQ0FBQztRQUMvQixNQUFNLENBQUMsSUFBSTtJQUNiLENBQUM7SUFFREksSUFBSSxDQUFDQyxRQUFnQixFQUFXLENBQUM7UUFDL0IsTUFBTSxDQUFDLElBQUk7SUFDYixDQUFDOztRQXRCVVIsT0FBTyxHQUFQQSxPQUFPO0FBd0NwQixLQUFLLENBQUNTLFFBQVEsSUFBb0JDLGVBQWUsRUFBRUMsT0FBTyxFQUFFQyxhQUFhLEdBQUdDLE9BQU8sQ0FBQ0MsSUFBSSxHQUFLLENBQUM7SUFDNUYsR0FBRyxDQUFDQyxLQUFLLEdBQUcsR0FBRyxDQUFDZixPQUFPLENBQUNVLGVBQWU7SUFDdkMsRUFBRSxFQUFFRCxRQUFRLENBQUNPLFdBQVcsRUFBRSxDQUFDO1FBQ3pCRCxLQUFLLE9BQUdFLElBQUcsVUFBQ1AsZUFBZSxFQUFFTCxLQUFLO0lBQ3BDLENBQUM7SUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDYSxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsTUFBTSxHQUFLLENBQUM7UUFDdkNULE9BQU8sQ0FBQ0ksS0FBSyxFQUNWTSxJQUFJLEtBQU8sQ0FBQztZQUNYLEtBQUssQ0FBQ0MsU0FBUyxHQUFHVCxPQUFPLENBQUNVLEtBQUssQ0FBQ0MsUUFBUTtZQUV4QyxFQUErRCxBQUEvRCw2REFBK0Q7WUFDL0RULEtBQUssQ0FBQ2IsT0FBTztZQUViLEVBQUUsRUFBRU8sUUFBUSxDQUFDZ0IsZ0JBQWdCLEtBQUtILFNBQVMsSUFBSVQsT0FBTyxDQUFDVSxLQUFLLENBQUNDLFFBQVEsSUFBSSxDQUFDO2dCQUN4RVgsT0FBTyxDQUFDVSxLQUFLLENBQUNHLE1BQU07WUFDdEIsQ0FBQztZQUVELE1BQU0sQ0FBQ1AsT0FBTztRQUNoQixDQUFDLEVBQ0FRLEtBQUssRUFBRUMsR0FBRyxHQUFLLENBQUM7WUFDZmIsS0FBSyxDQUFDWCxJQUFJO1lBQ1YsRUFBRSxFQUFFSyxRQUFRLENBQUNPLFdBQVcsRUFBRSxDQUFDO2dCQUN6QixFQUFFLEVBQUVZLEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxPQUFPLElBQUlELEdBQUcsQ0FBQ0UsS0FBSyxFQUFFLENBQUM7b0JBQ3BDQyxPQUFPLENBQUNDLEtBQUssQ0FBQ0MsTUFBSyxTQUFDQyxHQUFHLENBQUMsQ0FBaUQ7b0JBQ3pFSCxPQUFPLENBQUNDLEtBQUssQ0FBQ0MsTUFBSyxTQUFDQyxHQUFHLENBQUNOLEdBQUcsQ0FBQ0MsT0FBTztvQkFDbkNFLE9BQU8sQ0FBQ0MsS0FBSyxDQUFDQyxNQUFLLFNBQUNDLEdBQUcsQ0FBQ04sR0FBRyxDQUFDRSxLQUFLO2dCQUNuQyxDQUFDLE1BQU0sQ0FBQztvQkFDTkMsT0FBTyxDQUFDQyxLQUFLLENBQUNDLE1BQUssU0FBQ0MsR0FBRyxDQUFDLENBQWtDO29CQUMxREgsT0FBTyxDQUFDQyxLQUFLLENBQUNDLE1BQUssU0FBQ0MsR0FBRyxDQUFDLE1BQU0sQ0FBQ04sR0FBRyxLQUFLLENBQVEsVUFBR0EsR0FBRyxHQUFHTyxJQUFJLENBQUNDLFNBQVMsQ0FBQ1IsR0FBRztnQkFDNUUsQ0FBQztnQkFDRGhCLGFBQWEsQ0FBQyxDQUFDO2dCQUNmLEVBQWtFLEFBQWxFLGdFQUFrRTtnQkFDbEUsRUFBOEQsQUFBOUQsNERBQThEO2dCQUM5RHlCLFVBQVUsS0FBT2xCLE9BQU87a0JBQUksR0FBRztZQUNqQyxDQUFDLE1BQU0sQ0FBQztnQkFDTkMsTUFBTSxDQUFDUSxHQUFHO1lBQ1osQ0FBQztRQUNILENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQztBQUVEbkIsUUFBUSxDQUFDTyxXQUFXLEdBQUcsSUFBSTtlQUVaUCxRQUFRIn0=