/*!
 * @pixi/spritesheet - v6.2.0
 * Compiled Mon, 01 Nov 2021 16:52:10 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
this.PIXI=this.PIXI||{};var _pixi_spritesheet=function(t,e,r,s,a){"use strict";var i=function(){function t(t,e,s){void 0===s&&(s=null),this._texture=t instanceof r.Texture?t:null,this.baseTexture=t instanceof r.BaseTexture?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var a=this.baseTexture.resource;this.resolution=this._updateResolution(s||(a?a.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,r=s.getResolutionOfUrl(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(s){for(var a=s,i=t.BATCH_SIZE;a-s<i&&a<this._frameKeys.length;){var o=this._frameKeys[a],n=this._frames[o],u=n.frame;if(u){var l=null,h=null,c=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,f=new e.Rectangle(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);l=n.rotated?new e.Rectangle(Math.floor(u.x)/this.resolution,Math.floor(u.y)/this.resolution,Math.floor(u.h)/this.resolution,Math.floor(u.w)/this.resolution):new e.Rectangle(Math.floor(u.x)/this.resolution,Math.floor(u.y)/this.resolution,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(h=new e.Rectangle(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution)),this.textures[o]=new r.Texture(this.baseTexture,l,f,h,n.rotated?2:0,n.anchor),r.Texture.addToCache(this.textures[o],o)}a++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var s=t[e][r];this.animations[e].push(this.textures[s])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},t.prototype.destroy=function(t){var e;for(var r in void 0===t&&(t=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),o=function(){function t(){}return t.use=function(e,r){var o,n,u=this,l=e.name+"_image";if(e.data&&e.type===a.LoaderResource.TYPE.JSON&&e.data.frames&&!u.resources[l]){var h=null===(n=null===(o=e.data)||void 0===o?void 0:o.meta)||void 0===n?void 0:n.related_multi_packs;if(Array.isArray(h))for(var c=function(t){if("string"!=typeof t)return"continue";var r=t.replace(".json",""),i=s.url.resolve(e.url.replace(u.baseUrl,""),t);if(u.resources[r]||Object.values(u.resources).some(function(t){return s.url.format(s.url.parse(t.url))===i}))return"continue";var o={crossOrigin:e.crossOrigin,loadType:a.LoaderResource.LOAD_TYPE.XHR,xhrType:a.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};u.add(r,i,o)},f=0,d=h;f<d.length;f++){c(d[f])}var p={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},_=t.getResourcePath(e,u.baseUrl);u.add(l,_,p,function(t){if(t.error)r(t.error);else{var s=new i(t.texture,e.data,e.url);s.parse(function(){e.spritesheet=s,e.textures=s.textures,r()})}})}else r()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:s.url.resolve(t.url.replace(e,""),t.data.meta.image)},t}();return t.Spritesheet=i,t.SpritesheetLoader=o,t}({},PIXI,PIXI,PIXI.utils,PIXI);Object.assign(this.PIXI,_pixi_spritesheet);
//# sourceMappingURL=spritesheet.min.js.map
