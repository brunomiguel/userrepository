"use strict";
var _core = require("@electron-forge/core");
var _fsExtra = _interopRequireDefault(require("fs-extra"));
var _path = _interopRequireDefault(require("path"));
var _commander = _interopRequireDefault(require("commander"));
require("./util/terminate");
var _workingDir = _interopRequireDefault(require("./util/working-dir"));
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
(async ()=>{
    let commandArgs = process.argv;
    let appArgs;
    const doubleDashIndex = process.argv.indexOf('--');
    if (doubleDashIndex !== -1) {
        commandArgs = process.argv.slice(0, doubleDashIndex);
        appArgs = process.argv.slice(doubleDashIndex + 1);
    }
    let dir = process.cwd();
    _commander.default.version((await _fsExtra.default.readJson(_path.default.resolve(__dirname, '../package.json'))).version).arguments('[cwd]').option('-p, --app-path <path>', "Override the path to the Electron app to launch (defaults to '.')").option('-l, --enable-logging', 'Enable advanced logging.  This will log internal Electron things').option('-n, --run-as-node', 'Run the Electron app as a Node.JS script').option('--vscode', 'Used to enable arg transformation for debugging Electron through VSCode.  Do not use yourself.').option('-i, --inspect-electron', 'Triggers inspect mode on Electron to allow debugging the main process.  Electron >1.7 only').option('--inspect-brk-electron', 'Triggers inspect-brk mode on Electron to allow debugging the main process.  Electron >1.7 only').action((cwd)=>{
        dir = (0, _workingDir).default(dir, cwd);
    }).parse(commandArgs);
    _commander.default.on('--help', ()=>{
        console.log('  Any arguments found after "--" will be passed to the Electron app, e.g.');
        console.log('');
        console.log('    $ electron-forge /path/to/project -l -- -d -f foo.txt');
        console.log('');
        console.log('  will pass the arguments "-d -f foo.txt" to the Electron app');
    });
    const opts = {
        dir,
        interactive: true,
        enableLogging: !!_commander.default.enableLogging,
        runAsNode: !!_commander.default.runAsNode,
        inspect: !!_commander.default.inspectElectron,
        inspectBrk: !!_commander.default.inspectBrkElectron
    };
    if (_commander.default.vscode && appArgs) {
        // Args are in the format ~arg~ so we need to strip the "~"
        appArgs = appArgs.map((arg)=>arg.substr(1, arg.length - 2)
        ).filter((arg)=>arg.length > 0
        );
    }
    if (_commander.default.appPath) opts.appPath = _commander.default.appPath;
    if (appArgs) opts.args = appArgs;
    const spawned = await _core.api.start(opts);
    await new Promise((resolve)=>{
        const listenForExit = (child)=>{
            // Why: changing to const causes TypeScript compilation to fail.
            /* eslint-disable prefer-const */ let onExit;
            let onRestart;
            /* eslint-enable prefer-const */ const removeListeners = ()=>{
                child.removeListener('exit', onExit);
                child.removeListener('restarted', onRestart);
            };
            onExit = (code)=>{
                removeListeners();
                if (spawned.restarted) return;
                if (code !== 0) {
                    process.exit(code);
                }
                resolve();
            };
            onRestart = (newChild)=>{
                removeListeners();
                listenForExit(newChild);
            };
            child.on('exit', onExit);
            child.on('restarted', onRestart);
        };
        listenForExit(spawned);
    });
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbi1mb3JnZS1zdGFydC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcGksIFN0YXJ0T3B0aW9ucyB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9jb3JlJztcbmltcG9ydCB7IEVsZWN0cm9uUHJvY2VzcyB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9zaGFyZWQtdHlwZXMnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHByb2dyYW0gZnJvbSAnY29tbWFuZGVyJztcblxuaW1wb3J0ICcuL3V0aWwvdGVybWluYXRlJztcbmltcG9ydCB3b3JraW5nRGlyIGZyb20gJy4vdXRpbC93b3JraW5nLWRpcic7XG5cbihhc3luYyAoKSA9PiB7XG4gIGxldCBjb21tYW5kQXJncyA9IHByb2Nlc3MuYXJndjtcbiAgbGV0IGFwcEFyZ3M7XG5cbiAgY29uc3QgZG91YmxlRGFzaEluZGV4ID0gcHJvY2Vzcy5hcmd2LmluZGV4T2YoJy0tJyk7XG4gIGlmIChkb3VibGVEYXNoSW5kZXggIT09IC0xKSB7XG4gICAgY29tbWFuZEFyZ3MgPSBwcm9jZXNzLmFyZ3Yuc2xpY2UoMCwgZG91YmxlRGFzaEluZGV4KTtcbiAgICBhcHBBcmdzID0gcHJvY2Vzcy5hcmd2LnNsaWNlKGRvdWJsZURhc2hJbmRleCArIDEpO1xuICB9XG5cbiAgbGV0IGRpciA9IHByb2Nlc3MuY3dkKCk7XG4gIHByb2dyYW1cbiAgICAudmVyc2lvbigoYXdhaXQgZnMucmVhZEpzb24ocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uL3BhY2thZ2UuanNvbicpKSkudmVyc2lvbilcbiAgICAuYXJndW1lbnRzKCdbY3dkXScpXG4gICAgLm9wdGlvbignLXAsIC0tYXBwLXBhdGggPHBhdGg+JywgXCJPdmVycmlkZSB0aGUgcGF0aCB0byB0aGUgRWxlY3Ryb24gYXBwIHRvIGxhdW5jaCAoZGVmYXVsdHMgdG8gJy4nKVwiKVxuICAgIC5vcHRpb24oJy1sLCAtLWVuYWJsZS1sb2dnaW5nJywgJ0VuYWJsZSBhZHZhbmNlZCBsb2dnaW5nLiAgVGhpcyB3aWxsIGxvZyBpbnRlcm5hbCBFbGVjdHJvbiB0aGluZ3MnKVxuICAgIC5vcHRpb24oJy1uLCAtLXJ1bi1hcy1ub2RlJywgJ1J1biB0aGUgRWxlY3Ryb24gYXBwIGFzIGEgTm9kZS5KUyBzY3JpcHQnKVxuICAgIC5vcHRpb24oJy0tdnNjb2RlJywgJ1VzZWQgdG8gZW5hYmxlIGFyZyB0cmFuc2Zvcm1hdGlvbiBmb3IgZGVidWdnaW5nIEVsZWN0cm9uIHRocm91Z2ggVlNDb2RlLiAgRG8gbm90IHVzZSB5b3Vyc2VsZi4nKVxuICAgIC5vcHRpb24oJy1pLCAtLWluc3BlY3QtZWxlY3Ryb24nLCAnVHJpZ2dlcnMgaW5zcGVjdCBtb2RlIG9uIEVsZWN0cm9uIHRvIGFsbG93IGRlYnVnZ2luZyB0aGUgbWFpbiBwcm9jZXNzLiAgRWxlY3Ryb24gPjEuNyBvbmx5JylcbiAgICAub3B0aW9uKCctLWluc3BlY3QtYnJrLWVsZWN0cm9uJywgJ1RyaWdnZXJzIGluc3BlY3QtYnJrIG1vZGUgb24gRWxlY3Ryb24gdG8gYWxsb3cgZGVidWdnaW5nIHRoZSBtYWluIHByb2Nlc3MuICBFbGVjdHJvbiA+MS43IG9ubHknKVxuICAgIC5hY3Rpb24oKGN3ZCkgPT4ge1xuICAgICAgZGlyID0gd29ya2luZ0RpcihkaXIsIGN3ZCk7XG4gICAgfSlcbiAgICAucGFyc2UoY29tbWFuZEFyZ3MpO1xuXG4gIHByb2dyYW0ub24oJy0taGVscCcsICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnICBBbnkgYXJndW1lbnRzIGZvdW5kIGFmdGVyIFwiLS1cIiB3aWxsIGJlIHBhc3NlZCB0byB0aGUgRWxlY3Ryb24gYXBwLCBlLmcuJyk7XG4gICAgY29uc29sZS5sb2coJycpO1xuICAgIGNvbnNvbGUubG9nKCcgICAgJCBlbGVjdHJvbi1mb3JnZSAvcGF0aC90by9wcm9qZWN0IC1sIC0tIC1kIC1mIGZvby50eHQnKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgY29uc29sZS5sb2coJyAgd2lsbCBwYXNzIHRoZSBhcmd1bWVudHMgXCItZCAtZiBmb28udHh0XCIgdG8gdGhlIEVsZWN0cm9uIGFwcCcpO1xuICB9KTtcblxuICBjb25zdCBvcHRzOiBTdGFydE9wdGlvbnMgPSB7XG4gICAgZGlyLFxuICAgIGludGVyYWN0aXZlOiB0cnVlLFxuICAgIGVuYWJsZUxvZ2dpbmc6ICEhcHJvZ3JhbS5lbmFibGVMb2dnaW5nLFxuICAgIHJ1bkFzTm9kZTogISFwcm9ncmFtLnJ1bkFzTm9kZSxcbiAgICBpbnNwZWN0OiAhIXByb2dyYW0uaW5zcGVjdEVsZWN0cm9uLFxuICAgIGluc3BlY3RCcms6ICEhcHJvZ3JhbS5pbnNwZWN0QnJrRWxlY3Ryb24sXG4gIH07XG5cbiAgaWYgKHByb2dyYW0udnNjb2RlICYmIGFwcEFyZ3MpIHtcbiAgICAvLyBBcmdzIGFyZSBpbiB0aGUgZm9ybWF0IH5hcmd+IHNvIHdlIG5lZWQgdG8gc3RyaXAgdGhlIFwiflwiXG4gICAgYXBwQXJncyA9IGFwcEFyZ3MubWFwKChhcmcpID0+IGFyZy5zdWJzdHIoMSwgYXJnLmxlbmd0aCAtIDIpKS5maWx0ZXIoKGFyZykgPT4gYXJnLmxlbmd0aCA+IDApO1xuICB9XG5cbiAgaWYgKHByb2dyYW0uYXBwUGF0aCkgb3B0cy5hcHBQYXRoID0gcHJvZ3JhbS5hcHBQYXRoO1xuICBpZiAoYXBwQXJncykgb3B0cy5hcmdzID0gYXBwQXJncztcblxuICBjb25zdCBzcGF3bmVkID0gYXdhaXQgYXBpLnN0YXJ0KG9wdHMpO1xuXG4gIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3QgbGlzdGVuRm9yRXhpdCA9IChjaGlsZDogRWxlY3Ryb25Qcm9jZXNzKSA9PiB7XG4gICAgICAvLyBXaHk6IGNoYW5naW5nIHRvIGNvbnN0IGNhdXNlcyBUeXBlU2NyaXB0IGNvbXBpbGF0aW9uIHRvIGZhaWwuXG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBwcmVmZXItY29uc3QgKi9cbiAgICAgIGxldCBvbkV4aXQ6IE5vZGVKUy5FeGl0TGlzdGVuZXI7XG4gICAgICBsZXQgb25SZXN0YXJ0OiAobmV3Q2hpbGQ6IEVsZWN0cm9uUHJvY2VzcykgPT4gdm9pZDtcbiAgICAgIC8qIGVzbGludC1lbmFibGUgcHJlZmVyLWNvbnN0ICovXG4gICAgICBjb25zdCByZW1vdmVMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgICAgIGNoaWxkLnJlbW92ZUxpc3RlbmVyKCdleGl0Jywgb25FeGl0KTtcbiAgICAgICAgY2hpbGQucmVtb3ZlTGlzdGVuZXIoJ3Jlc3RhcnRlZCcsIG9uUmVzdGFydCk7XG4gICAgICB9O1xuICAgICAgb25FeGl0ID0gKGNvZGU6IG51bWJlcikgPT4ge1xuICAgICAgICByZW1vdmVMaXN0ZW5lcnMoKTtcbiAgICAgICAgaWYgKHNwYXduZWQucmVzdGFydGVkKSByZXR1cm47XG4gICAgICAgIGlmIChjb2RlICE9PSAwKSB7XG4gICAgICAgICAgcHJvY2Vzcy5leGl0KGNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBvblJlc3RhcnQgPSAobmV3Q2hpbGQ6IEVsZWN0cm9uUHJvY2VzcykgPT4ge1xuICAgICAgICByZW1vdmVMaXN0ZW5lcnMoKTtcbiAgICAgICAgbGlzdGVuRm9yRXhpdChuZXdDaGlsZCk7XG4gICAgICB9O1xuICAgICAgY2hpbGQub24oJ2V4aXQnLCBvbkV4aXQpO1xuICAgICAgY2hpbGQub24oJ3Jlc3RhcnRlZCcsIG9uUmVzdGFydCk7XG4gICAgfTtcbiAgICBsaXN0ZW5Gb3JFeGl0KHNwYXduZWQgYXMgRWxlY3Ryb25Qcm9jZXNzKTtcbiAgfSk7XG59KSgpO1xuIl0sIm5hbWVzIjpbImNvbW1hbmRBcmdzIiwicHJvY2VzcyIsImFyZ3YiLCJhcHBBcmdzIiwiZG91YmxlRGFzaEluZGV4IiwiaW5kZXhPZiIsInNsaWNlIiwiZGlyIiwiY3dkIiwicHJvZ3JhbSIsInZlcnNpb24iLCJmcyIsInJlYWRKc29uIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJhcmd1bWVudHMiLCJvcHRpb24iLCJhY3Rpb24iLCJ3b3JraW5nRGlyIiwicGFyc2UiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJvcHRzIiwiaW50ZXJhY3RpdmUiLCJlbmFibGVMb2dnaW5nIiwicnVuQXNOb2RlIiwiaW5zcGVjdCIsImluc3BlY3RFbGVjdHJvbiIsImluc3BlY3RCcmsiLCJpbnNwZWN0QnJrRWxlY3Ryb24iLCJ2c2NvZGUiLCJtYXAiLCJhcmciLCJzdWJzdHIiLCJsZW5ndGgiLCJmaWx0ZXIiLCJhcHBQYXRoIiwiYXJncyIsInNwYXduZWQiLCJhcGkiLCJzdGFydCIsIlByb21pc2UiLCJsaXN0ZW5Gb3JFeGl0IiwiY2hpbGQiLCJvbkV4aXQiLCJvblJlc3RhcnQiLCJyZW1vdmVMaXN0ZW5lcnMiLCJyZW1vdmVMaXN0ZW5lciIsImNvZGUiLCJyZXN0YXJ0ZWQiLCJleGl0IiwibmV3Q2hpbGQiXSwibWFwcGluZ3MiOiI7QUFBa0MsR0FBc0IsQ0FBdEIsS0FBc0I7QUFFekMsR0FBVSxDQUFWLFFBQVU7QUFDUixHQUFNLENBQU4sS0FBTTtBQUNILEdBQVcsQ0FBWCxVQUFXOztBQUdSLEdBQW9CLENBQXBCLFdBQW9COzs7Ozs7V0FFOUIsQ0FBQztJQUNaLEdBQUcsQ0FBQ0EsV0FBVyxHQUFHQyxPQUFPLENBQUNDLElBQUk7SUFDOUIsR0FBRyxDQUFDQyxPQUFPO0lBRVgsS0FBSyxDQUFDQyxlQUFlLEdBQUdILE9BQU8sQ0FBQ0MsSUFBSSxDQUFDRyxPQUFPLENBQUMsQ0FBSTtJQUNqRCxFQUFFLEVBQUVELGVBQWUsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUMzQkosV0FBVyxHQUFHQyxPQUFPLENBQUNDLElBQUksQ0FBQ0ksS0FBSyxDQUFDLENBQUMsRUFBRUYsZUFBZTtRQUNuREQsT0FBTyxHQUFHRixPQUFPLENBQUNDLElBQUksQ0FBQ0ksS0FBSyxDQUFDRixlQUFlLEdBQUcsQ0FBQztJQUNs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