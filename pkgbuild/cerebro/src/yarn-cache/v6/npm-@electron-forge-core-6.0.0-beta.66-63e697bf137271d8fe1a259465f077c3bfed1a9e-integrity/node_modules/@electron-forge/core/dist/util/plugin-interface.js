"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = void 0;
var _pluginBase = _interopRequireDefault(require("@electron-forge/plugin-base"));
var _debug = _interopRequireDefault(require("debug"));
var _requireSearch = _interopRequireDefault(require("./require-search"));
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const d = (0, _debug).default('electron-forge:plugins');
class PluginInterface {
    constructor(dir, forgeConfig){
        this.plugins = forgeConfig.plugins.map((plugin)=>{
            // eslint-disable-next-line no-underscore-dangle
            if (plugin.__isElectronForgePlugin) {
                return plugin;
            }
            if (Array.isArray(plugin)) {
                const [pluginName, opts = {}] = plugin;
                if (typeof pluginName !== 'string') {
                    throw new Error(`Expected plugin[0] to be a string but found ${pluginName}`);
                }
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                const Plugin = (0, _requireSearch).default(dir, [
                    pluginName
                ]);
                if (!Plugin) {
                    throw new Error(`Could not find module with name: ${plugin[0]}. Make sure it's listed in the devDependencies of your package.json`);
                }
                return new Plugin(opts);
            }
            throw new Error(`Expected plugin to either be a plugin instance or [string, object] but found ${plugin}`);
        });
        // TODO: fix hack
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        this.config = null;
        Object.defineProperty(this, 'config', {
            value: forgeConfig,
            enumerable: false,
            configurable: false,
            writable: false
        });
        for (const plugin1 of this.plugins){
            plugin1.init(dir, forgeConfig);
        }
        this.triggerHook = this.triggerHook.bind(this);
        this.overrideStartLogic = this.overrideStartLogic.bind(this);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    async triggerHook(hookName, hookArgs) {
        for (const plugin of this.plugins){
            if (typeof plugin.getHook === 'function') {
                const hook = plugin.getHook(hookName);
                if (hook) await hook(this.config, ...hookArgs);
            }
        }
    }
    async triggerMutatingHook(hookName, item) {
        for (const plugin of this.plugins){
            if (typeof plugin.getHook === 'function') {
                const hook = plugin.getHook(hookName);
                if (hook) {
                    item = await hook(this.config, item);
                }
            }
        }
        return item;
    }
    async overrideStartLogic(opts) {
        let newStartFn;
        const claimed = [];
        for (const plugin of this.plugins){
            if (typeof plugin.startLogic === 'function' && plugin.startLogic !== _pluginBase.default.prototype.startLogic) {
                claimed.push(plugin.name);
                newStartFn = plugin.startLogic;
            }
        }
        if (claimed.length > 1) {
            throw new Error(`Multiple plugins tried to take control of the start command, please remove one of them\n --> ${claimed.join(', ')}`);
        }
        if (claimed.length === 1 && newStartFn) {
            d(`plugin: "${claimed[0]}" has taken control of the start command`);
            return newStartFn(opts);
        }
        return false;
    }
}
exports.default = PluginInterface;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3BsdWdpbi1pbnRlcmZhY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBsdWdpbkJhc2UgZnJvbSAnQGVsZWN0cm9uLWZvcmdlL3BsdWdpbi1iYXNlJztcbmltcG9ydCB7IElGb3JnZVBsdWdpbkludGVyZmFjZSwgRm9yZ2VDb25maWcsIElGb3JnZVBsdWdpbiwgU3RhcnRSZXN1bHQgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcbmltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5cbmltcG9ydCB7IFN0YXJ0T3B0aW9ucyB9IGZyb20gJy4uL2FwaSc7XG5pbXBvcnQgcmVxdWlyZVNlYXJjaCBmcm9tICcuL3JlcXVpcmUtc2VhcmNoJztcblxuY29uc3QgZCA9IGRlYnVnKCdlbGVjdHJvbi1mb3JnZTpwbHVnaW5zJyk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsdWdpbkludGVyZmFjZSBpbXBsZW1lbnRzIElGb3JnZVBsdWdpbkludGVyZmFjZSB7XG4gIHByaXZhdGUgcGx1Z2luczogSUZvcmdlUGx1Z2luW107XG5cbiAgcHJpdmF0ZSBjb25maWc6IEZvcmdlQ29uZmlnO1xuXG4gIGNvbnN0cnVjdG9yKGRpcjogc3RyaW5nLCBmb3JnZUNvbmZpZzogRm9yZ2VDb25maWcpIHtcbiAgICB0aGlzLnBsdWdpbnMgPSBmb3JnZUNvbmZpZy5wbHVnaW5zLm1hcCgocGx1Z2luKSA9PiB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZXJzY29yZS1kYW5nbGVcbiAgICAgIGlmICgocGx1Z2luIGFzIElGb3JnZVBsdWdpbikuX19pc0VsZWN0cm9uRm9yZ2VQbHVnaW4pIHtcbiAgICAgICAgcmV0dXJuIHBsdWdpbjtcbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGx1Z2luKSkge1xuICAgICAgICBjb25zdCBbcGx1Z2luTmFtZSwgb3B0cyA9IHt9XSA9IHBsdWdpbjtcbiAgICAgICAgaWYgKHR5cGVvZiBwbHVnaW5OYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgcGx1Z2luWzBdIHRvIGJlIGEgc3RyaW5nIGJ1dCBmb3VuZCAke3BsdWdpbk5hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgY29uc3QgUGx1Z2luID0gcmVxdWlyZVNlYXJjaDxhbnk+KGRpciwgW3BsdWdpbk5hbWVdKTtcbiAgICAgICAgaWYgKCFQbHVnaW4pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIG1vZHVsZSB3aXRoIG5hbWU6ICR7cGx1Z2luWzBdfS4gTWFrZSBzdXJlIGl0J3MgbGlzdGVkIGluIHRoZSBkZXZEZXBlbmRlbmNpZXMgb2YgeW91ciBwYWNrYWdlLmpzb25gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFBsdWdpbihvcHRzKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgcGx1Z2luIHRvIGVpdGhlciBiZSBhIHBsdWdpbiBpbnN0YW5jZSBvciBbc3RyaW5nLCBvYmplY3RdIGJ1dCBmb3VuZCAke3BsdWdpbn1gKTtcbiAgICB9KTtcbiAgICAvLyBUT0RPOiBmaXggaGFja1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgdGhpcy5jb25maWcgPSBudWxsIGFzIGFueTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2NvbmZpZycsIHtcbiAgICAgIHZhbHVlOiBmb3JnZUNvbmZpZyxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIHRoaXMucGx1Z2lucykge1xuICAgICAgcGx1Z2luLmluaXQoZGlyLCBmb3JnZUNvbmZpZyk7XG4gICAgfVxuXG4gICAgdGhpcy50cmlnZ2VySG9vayA9IHRoaXMudHJpZ2dlckhvb2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm92ZXJyaWRlU3RhcnRMb2dpYyA9IHRoaXMub3ZlcnJpZGVTdGFydExvZ2ljLmJpbmQodGhpcyk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBhc3luYyB0cmlnZ2VySG9vayhob29rTmFtZTogc3RyaW5nLCBob29rQXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmdldEhvb2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgaG9vayA9IHBsdWdpbi5nZXRIb29rKGhvb2tOYW1lKTtcbiAgICAgICAgaWYgKGhvb2spIGF3YWl0IGhvb2sodGhpcy5jb25maWcsIC4uLmhvb2tBcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyB0cmlnZ2VyTXV0YXRpbmdIb29rPFQ+KGhvb2tOYW1lOiBzdHJpbmcsIGl0ZW06IFQpOiBQcm9taXNlPFQ+IHtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmdldEhvb2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgaG9vayA9IHBsdWdpbi5nZXRIb29rKGhvb2tOYW1lKTtcbiAgICAgICAgaWYgKGhvb2spIHtcbiAgICAgICAgICBpdGVtID0gYXdhaXQgaG9vayh0aGlzLmNvbmZpZywgaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGl0ZW07XG4gIH1cblxuICBhc3luYyBvdmVycmlkZVN0YXJ0TG9naWMob3B0czogU3RhcnRPcHRpb25zKTogUHJvbWlzZTxTdGFydFJlc3VsdD4ge1xuICAgIGxldCBuZXdTdGFydEZuO1xuICAgIGNvbnN0IGNsYWltZWQgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiB0aGlzLnBsdWdpbnMpIHtcbiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLnN0YXJ0TG9naWMgPT09ICdmdW5jdGlvbicgJiYgcGx1Z2luLnN0YXJ0TG9naWMgIT09IFBsdWdpbkJhc2UucHJvdG90eXBlLnN0YXJ0TG9naWMpIHtcbiAgICAgICAgY2xhaW1lZC5wdXNoKHBsdWdpbi5uYW1lKTtcbiAgICAgICAgbmV3U3RhcnRGbiA9IHBsdWdpbi5zdGFydExvZ2ljO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY2xhaW1lZC5sZW5ndGggPiAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE11bHRpcGxlIHBsdWdpbnMgdHJpZWQgdG8gdGFrZSBjb250cm9sIG9mIHRoZSBzdGFydCBjb21tYW5kLCBwbGVhc2UgcmVtb3ZlIG9uZSBvZiB0aGVtXFxuIC0tPiAke2NsYWltZWQuam9pbignLCAnKX1gKTtcbiAgICB9XG4gICAgaWYgKGNsYWltZWQubGVuZ3RoID09PSAxICYmIG5ld1N0YXJ0Rm4pIHtcbiAgICAgIGQoYHBsdWdpbjogXCIke2NsYWltZWRbMF19XCIgaGFzIHRha2VuIGNvbnRyb2wgb2YgdGhlIHN0YXJ0IGNvbW1hbmRgKTtcbiAgICAgIHJldHVybiBuZXdTdGFydEZuKG9wdHMpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJkIiwiZGVidWciLCJQbHVnaW5JbnRlcmZhY2UiLCJkaXIiLCJmb3JnZUNvbmZpZyIsInBsdWdpbnMiLCJtYXAiLCJwbHVnaW4iLCJfX2lzRWxlY3Ryb25Gb3JnZVBsdWdpbiIsIkFycmF5IiwiaXNBcnJheSIsInBsdWdpbk5hbWUiLCJvcHRzIiwiRXJyb3IiLCJQbHVnaW4iLCJyZXF1aXJlU2VhcmNoIiwiY29uZmlnIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImluaXQiLCJ0cmlnZ2VySG9vayIsImJpbmQiLCJvdmVycmlkZVN0YXJ0TG9naWMiLCJob29rTmFtZSIsImhvb2tBcmdzIiwiZ2V0SG9vayIsImhvb2siLCJ0cmlnZ2VyTXV0YXRpbmdIb29rIiwiaXRlbSIsIm5ld1N0YXJ0Rm4iLCJjbGFpbWVkIiwic3RhcnRMb2dpYyIsIlBsdWdpbkJhc2UiLCJwcm90b3R5cGUiLCJwdXNoIiwibmFtZSIsImxlbmd0aCIsImpvaW4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQXVCLEdBQTZCLENBQTdCLFdBQTZCO0FBRWxDLEdBQU8sQ0FBUCxNQUFPO0FBR0MsR0FBa0IsQ0FBbEIsY0FBa0I7Ozs7OztBQUU1QyxLQUFLLENBQUNBLENBQUMsT0FBR0MsTUFBSyxVQUFDLENBQXdCO01BRW5CQyxlQUFlO2dCQUt0QkMsR0FBVyxFQUFFQyxXQUF3QixDQUFFLENBQUM7UUFDbEQsSUFBSSxDQUFDQyxPQUFPLEdBQUdELFdBQVcsQ0FBQ0MsT0FBTyxDQUFDQyxHQUFHLEVBQUVDLE1BQU0sR0FBSyxDQUFDO1lBQ2xELEVBQWdELEFBQWhELDhDQUFnRDtZQUNoRCxFQUFFLEVBQUdBLE1BQU0sQ0FBa0JDLHVCQUF1QixFQUFFLENBQUM7Z0JBQ3JELE1BQU0sQ0FBQ0QsTUFBTTtZQUNmLENBQUM7WUFFRCxFQUFFLEVBQUVFLEtBQUssQ0FBQ0MsT0FBTyxDQUFDSCxNQUFNLEdBQUcsQ0FBQztnQkFDMUIsS0FBSyxFQUFFSSxVQUFVLEVBQUVDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSUwsTUFBTTtnQkFDdEMsRUFBRSxFQUFFLE1BQU0sQ0FBQ0ksVUFBVSxLQUFLLENBQVEsU0FBRSxDQUFDO29CQUNuQyxLQUFLLENBQUMsR0FBRyxDQUFDRSxL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